#!/bin/sh

tabs -1	>/dev/null		# requires ncurses (noterm doesn't yet know how to process tabs)

VERSION=0.1.5
echo sh-nosh $VERSION wrapper script for Nosh

echo Checking if online
ONLINE=no; ping www.google.com > /dev/null && ONLINE=yes
DEV=no; if [ $COMPUTERNAME = GOVMESH-BOOK ]; then DEV=yes; fi 

alias crowbar='rebar $REBAR_COMMANDS | grep -v "cannot handle URI.*edoc-info"'
alias clean='grep -v "Entering directory" | grep -v "Leaving directory"'

if [ $ONLINE = yes ]; then
	if [ $DEV = yes ]; then
		echo Pushing nosh built-ins repository
		cd /cygdrive/d/workspace/nosh_bin
		git push origin master

		echo Pushing nosh repository
		cd /cygdrive/d/workspace/nosh
		git push origin master
	fi

	cd /cygdrive/d/workspace/nosh

	REBAR_COMMANDS='update-deps compile doc'
	crowbar | clean
else
	echo "Working offline"
	cd /cygdrive/d/workspace/nosh
	
	REBAR_COMMANDS='compile doc'
	crowbar | clean
fi


html2text.py doc/overview-summary.html iso-8859-1 > README.md   # https://github.com/aaronsw/html2text

erl -pa "d:/workspace/nosh/ebin" -noshell -s noterm start
