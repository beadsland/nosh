#!/usr/bin/env escript
%% -*- erlang -*-
%%! -deps dev

main(Param) ->
    BinDir = filename:absname(filename:dirname(escript:script_name())),
    AppDir = filename:absname_join(BinDir, ".."),
    EbinDir = filename:absname_join(AppDir, "ebin"),
    SrcDir = filename:absname_join(AppDir, "src"),

    Filename = filename:join(SrcDir, "bootstrap.erl"),
    Options = [verbose, warnings_as_errors, return_errors, binary,
               {outdir, EbinDir}],
    case compile:file(Filename, Options) of
        {ok, Module, Binary} ->
            code:load_binary(Module, Filename, Binary);
        _Else                ->
            io:format("Failed to bootstrap\n"),
            exit(bootstrap_failed)
    end,

    bootstrap:main(Param, AppDir).