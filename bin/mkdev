#!/bin/sh

DEPS=`grep 'git://github.com/' rebar.config \
        | awk -F\" '{print $2}' | awk -F/ '{print $5}'`
JUNCURL=http://download.sysinternals.com/files/Junction.zip
PLATFORM=`uname -o`

TARGET='dev' export TARGET
SOURCE='..' export SOURCE

LINK=`if [ $PLATFORM == "Cygwin" ]; \
    then (
		# EULA doesn't allow for redistribution, so we download from source.
        curl $JUNCURL > $TEMP/junction.zip 
        unzip -f $TEMP/junction.zip -d $TEMP > /dev/null
        chmod +x $TEMP/junction.exe > /dev/null
        LINK='{print "$TEMP/junction $TARGET/"$1" $SOURCE/"$1" 2>&1 | tail -2"}'
        echo $LINK
        );
    else (
        LINK='{print "ln -s \`cd $SOURCE/"$1"; pwd\` $TARGET/"$1 }'
        echo $LINK
        ); fi`

mkdir $TARGET
echo $DEPS | sed 's/ /\n/g' | awk "$LINK" | sh
